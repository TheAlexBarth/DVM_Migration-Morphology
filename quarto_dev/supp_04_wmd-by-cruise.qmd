---
title: Weighted Mean Depth Across cruises
---


Shown are the weighted mean depths across cruises. Missing values are removed.

```{r, fig.height=8, fig.width=10, fig.out = '100%'}

#| column: screen-inset

rm(list = ls())
library(EcotaxaTools)
library(ggplot2)
library(ggpubr)
library(lubridate)
source('../R/tools.R')

# |- load in data ---------------------------------------------
wmd_data <- readRDS('../data/04_wmd-by-cruise.rds')
uvp_data_meta <- readRDS('../data/01_uvp-trim-final.rds')$meta
uvp_data_meta$cruise_id <- paste0(uvp_data_meta$stationid,
                                  uvp_data_meta$programid)

uvp_data_meta$dateabv <- paste(year(uvp_data_meta$sampledate),
                               month(uvp_data_meta$sampledate),
                               '01', sep = '-') |> 
  as.Date()


# |- format wmd CIs for each cruise --------------------------
wmd_df <- wmd_df_construct(wmd_data,'cruise')

wmd_df$date <- wmd_df$date |> as.Date(origin = '1970-01-01')
wmd_df <- wmd_df[-which(wmd_df$metric == 'dn_diff'),]

###
# Plotting ################
###

# setting up a plotting shell
plot_list <- list(
  c1 = list(early = NULL,
            full = NULL),
  c2 = list(early = NULL,
            full = NULL),
  c3 = list(early = NULL,
            full = NULL),
  c4 = list(early = NULL,
            full = NULL)
)

for(i in 1:length(plot_list)) {
  clust <- names(plot_list)[i]
  plot_list[[i]]$early <- ggplot(wmd_df[year(wmd_df$date) < 2020 &
                                          wmd_df$cluster == clust,]) +
    geom_point(aes(x = date,
                   y = mid,
                   color = metric),
               position = position_dodge(width = 5)) +
    geom_errorbar(aes(x = date,
                      ymin = low,
                      ymax = high,
                      color = metric),
                  position = position_dodge(width=5)) +
    scale_y_reverse(limits = c(600,0)) +
    scale_x_date(date_labels = '%Y-%m',
                 date_breaks = '1 month') +
    labs(y = 'Depth [m]', col = "")+
    theme_pubr()+
    theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
  
  plot_list[[i]]$full <- ggplot(wmd_df[year(wmd_df$date) >= 2020 &
                                        wmd_df$cluster == clust,]) +
    geom_point(aes(x = date,
                   y = mid,
                   color = metric),
               position = position_dodge(width = 5)) +
    geom_errorbar(aes(x = date,
                      ymin = low,
                      ymax = high,
                      color = metric),
                  position = position_dodge(width=5)) +
    scale_y_reverse(limits = c(600,0)) +
    scale_x_date(date_labels = '%Y-%m',
                 date_breaks = '1 month') +
    labs(y = 'Depth [m]', col = "", x ="")+
    theme_pubr()+
    theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
}

ggarrange(plot_list$c1$early + 
            theme(axis.title.x = element_blank(),
                  axis.text.x = element_blank()), plot_list$c1$full + 
            theme(axis.title.y = element_blank(),
                  axis.text.y = element_blank(),
                  axis.text.x = element_blank(),
                  axis.line.y = element_blank(),
                  axis.ticks.y = element_blank(),
                  axis.title.x = element_blank()),
          plot_list$c2$early + 
            theme(axis.title.x = element_blank(),
                  axis.text.x = element_blank(),), plot_list$c2$full + 
            theme(axis.title.y = element_blank(),
                  axis.text.y = element_blank(),
                  axis.text.x = element_blank(),
                  axis.line.y = element_blank(),
                  axis.ticks.y = element_blank(),
                  axis.title.x = element_blank()),
          plot_list$c3$early + 
            theme(axis.title.x = element_blank(),
                  axis.text.x = element_blank(),), plot_list$c3$full + 
            theme(axis.title.y = element_blank(),
                  axis.text.y = element_blank(),
                  axis.text.x = element_blank(),
                  axis.line.y = element_blank(),
                  axis.ticks.y = element_blank(),
                  axis.title.x = element_blank()),
          plot_list$c4$early + 
            theme(axis.title.x = element_blank()), plot_list$c4$full + 
            theme(axis.title.y = element_blank(),
                  axis.text.y = element_blank(),
                  axis.line.y = element_blank(),
                  axis.ticks.y = element_blank(),
                  axis.title.x = element_blank()),
          nrow = 4, ncol = 2,
          common.legend = T,
          widths = c(0.15, 0.85))


```